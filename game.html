<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<title>2.5D Adventure</title>
<style>
body { margin:0; background:#111; overflow:hidden; }
canvas { background:#222; display:block; margin:auto; }
</style>
</head>
<body>

<canvas id="game" width="1280" height="720"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// WORLD SETTINGS
const TILE = 60;

// Simple height-map world (tiles punya ketinggian)
let world = [
  [0,0,0,1,1,0,0],
  [0,0,1,1,1,0,0],
  [0,1,1,2,1,1,0],
  [0,1,2,2,2,1,0],
  [0,1,1,2,1,1,0],
  [0,0,1,1,1,0,0],
  [0,0,0,1,0,0,0],
];

let player = {
  x: 3.5,
  y: 3.5,
  z: 0,
  speed: 3,
};

// --- DRAW TILE AS 2.5D BLOCK ---
function drawTile(x, y, h, camX, camY) {
  const sx = (x * TILE) - camX;
  const sy = (y * TILE) - camY;

  let top = sy - h * 20;

  // top face
  ctx.fillStyle = "#5a8";
  ctx.fillRect(sx, top, TILE, TILE);

  // right face
  ctx.fillStyle = "#487";
  ctx.beginPath();
  ctx.moveTo(sx + TILE, top);
  ctx.lineTo(sx + TILE + 20, top + 20);
  ctx.lineTo(sx + TILE + 20, top + TILE + 20);
  ctx.lineTo(sx + TILE, top + TILE);
  ctx.fill();

  // left face
  ctx.fillStyle = "#3a6";
  ctx.beginPath();
  ctx.moveTo(sx, top);
  ctx.lineTo(sx - 20, top + 20);
  ctx.lineTo(sx - 20, top + TILE + 20);
  ctx.lineTo(sx, top + TILE);
  ctx.fill();
}

// --- DRAW PLAYER ---
function drawPlayer(camX, camY) {
  let px = player.x * TILE - camX;
  let py = player.y * TILE - camY - player.z * 20;

  // shadow
  ctx.fillStyle = "rgba(0,0,0,0.4)";
  ctx.beginPath();
  ctx.ellipse(px + 20, py + 40, 22, 10, 0, 0, Math.PI * 2);
  ctx.fill();

  // body
  ctx.fillStyle = "#ffd35a";
  ctx.fillRect(px, py - 40, 40, 40);

  // head
  ctx.fillStyle = "#ffeb8a";
  ctx.beginPath();
  ctx.arc(px + 20, py - 50, 18, 0, Math.PI * 2);
  ctx.fill();
}

function update(dt) {
  let dx = 0, dy = 0;
  if (keys["w"]) dy -= 1;
  if (keys["s"]) dy += 1;
  if (keys["a"]) dx -= 1;
  if (keys["d"]) dx += 1;

  if (dx !== 0 && dy !== 0) {
    dx *= 0.7;
    dy *= 0.7;
  }

  player.x += dx * player.speed * dt;
  player.y += dy * player.speed * dt;

  // tile height follow
  player.z = world[Math.floor(player.y)]?.[Math.floor(player.x)] || 0;
}

function render() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const camX = player.x * TILE - canvas.width/2;
  const camY = player.y * TILE - canvas.height/2 + player.z * 20;

  // draw world
  for (let y=0; y<world.length; y++) {
    for (let x=0; x<world[0].length; x++) {
      drawTile(x, y, world[y][x], camX, camY);
    }
  }

  // draw player
  drawPlayer(camX, camY);
}

let last = 0;
function loop(t) {
  let dt = (t - last) / 1000;
  last = t;

  update(dt);
  render();

  requestAnimationFrame(loop);
}

// KEYS
let keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

// START
requestAnimationFrame(loop);
</script>

</body>
</html>
