<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>WebOS + Lockscreen Neon</title>

<style>
  /* RESET */
  html,body{
    margin:0;
    padding:0;
    height:100%;
    overflow:hidden;
    font-family:"Segoe UI",sans-serif;
    background:black;
    color:white;
  }

  /* ===== LOCKSCREEN LAYER ===== */
  #lockscreen{
    position:fixed;
    inset:0;
    z-index:9999;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    pointer-events:auto;
  }

  #lock-ui{
    text-align:center;
    backdrop-filter:blur(8px);
    background:rgba(255,255,255,0.03);
    padding:45px 50px;
    border-radius:20px;
    box-shadow:0 0 30px rgba(0,255,255,0.2);
    animation:fadeIn 0.7s forwards;
  }

  @keyframes fadeIn{
    from{opacity:0; transform:translateY(20px);}
    to{opacity:1; transform:translateY(0);}
  }

  #clock{
    font-size:90px;
    font-weight:700;
    color:#00eaff;
    text-shadow:0 0 20px #00eaff;
  }

  #date{
    font-size:22px;
    opacity:0.9;
    margin-top:-5px;
  }

  #hint{
    margin-top:20px;
    font-size:14px;
    opacity:0.7;
  }

  /* Fade-out saat unlock */
  .fadeOut{
    animation:fadeExit 0.7s forwards;
  }
  @keyframes fadeExit{
    to{opacity:0; filter:blur(6px);}
  }

  /* Shader canvas */
  #shaderCanvas{
    position:fixed;
    inset:0;
    width:100vw;
    height:100vh;
    display:block;
    z-index:9000;
  }
</style>
</head>

<body>

<!-- =============== LOCKSCREEN =============== -->
<canvas id="shaderCanvas"></canvas>

<div id="lockscreen">
  <div id="lock-ui">
    <div id="clock">00:00</div>
    <div id="date">Loading...</div>
    <div id="hint">Press any key or click to unlock</div>
  </div>
</div>

<script>
/* ================= CLOCK ================= */
const clockEl=document.getElementById("clock");
const dateEl=document.getElementById("date");

function updateClock(){
  const now=new Date();
  const t = now.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",hour12:false});
  const d = now.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long"});

  clockEl.textContent=t;
  dateEl.textContent=d;
}
updateClock();
setInterval(updateClock,1000);

/* =============== UNLOCK ================= */
let unlocked=false;
function unlock(){
  if(unlocked) return;
  unlocked=true;

  document.getElementById("lockscreen").classList.add("fadeOut");
  document.getElementById("shaderCanvas").classList.add("fadeOut");

  setTimeout(()=>{
    document.getElementById("lockscreen").style.display="none";
    document.getElementById("shaderCanvas").style.display="none";
    document.getElementById("desktop").style.display="block";
  },650);
}

window.addEventListener("keydown",unlock);
window.addEventListener("click",unlock);

/* ========== SHADER (100% SAME AS YOUR FILE) ========== */
const vertexShaderSource = `
attribute vec2 position;
void main() {
  gl_Position = vec4(position, 0.0, 1.0);
}
`;

const fragmentShaderSource = `
precision highp float;

uniform vec2 r;
uniform float t;

void main() {
  vec2 FC = gl_FragCoord.xy;
  vec2 p = (FC * 2.0 - r) / r.y;
  float a = atan(p.y, p.x);
  float l = length(p);
  vec3 c = vec3(0.0);

  for(float i = 0.0; i < 15.0; i++) {
    float m = sin(a * 10.0 + t * (2.0 + i * 0.5) - l * 20.0) * 0.05;
    c += vec3(2.0, i * 0.1, 1.0) * 0.0008 / abs(l - 0.5 - m + i * 0.015);
  }

  gl_FragColor = vec4(c, 1.0);
}
`;

function createShader(gl,type,source){
  const shader=gl.createShader(type);
  gl.shaderSource(shader,source);
  gl.compileShader(shader);
  return shader;
}

function createProgram(gl,vs,fs){
  const program=gl.createProgram();
  gl.attachShader(program,vs);
  gl.attachShader(program,fs);
  gl.linkProgram(program);
  return program;
}

(function startShader(){
  const canvas=document.getElementById("shaderCanvas");
  const gl=canvas.getContext("webgl");
  if(!gl){ alert("WebGL not supported"); return; }

  const vs=createShader(gl,gl.VERTEX_SHADER,vertexShaderSource);
  const fs=createShader(gl,gl.FRAGMENT_SHADER,fragmentShaderSource);
  const program=createProgram(gl,vs,fs);

  gl.useProgram(program);

  const buffer=gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER,buffer);
  gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([
    -1,-1, 1,-1, -1,1,
    1,-1, 1,1, -1,1
  ]),gl.STATIC_DRAW);

  const posLoc=gl.getAttribLocation(program,"position");
  gl.enableVertexAttribArray(posLoc);
  gl.vertexAttribPointer(posLoc,2,gl.FLOAT,false,0,0);

  const rLoc=gl.getUniformLocation(program,"r");
  const tLoc=gl.getUniformLocation(program,"t");

  function resize(){
    canvas.width=innerWidth;
    canvas.height=innerHeight;
    gl.viewport(0,0,canvas.width,canvas.height);
  }
  addEventListener("resize",resize);
  resize();

  let start=performance.now();
  function render(){
    const now=performance.now();
    const time=(now-start)*0.001;

    gl.uniform2f(rLoc,canvas.width,canvas.height);
    gl.uniform1f(tLoc,time);

    gl.drawArrays(gl.TRIANGLES,0,6);
    requestAnimationFrame(render);
  }
  render();
})();
</script>
<!-- ========== BAGIAN 2: DESKTOP + DOCK + START MENU + SCRIPTS ========== -->

<style>
  /* ---------- Desktop visuals (additional) ---------- */
  /* ensure desktop sits above stage when shown */
  #desktop{
    position:fixed;
    inset:0;
    z-index:8000;
    display:none; /* shown after unlock */
    overflow:hidden;
    background: #0b0b0b;
  }

  /* Video background (kept from original) */
  #video-background {
    position:fixed;
    right:0;
    bottom:0;
    min-width:100%;
    min-height:100%;
    width:auto;
    height:auto;
    z-index:8000;
    object-fit:cover;
  }

  /* Desktop Icon */
  .icon {
    position:absolute;
    top:40px;
    left:40px;
    width:80px;
    text-align:center;
    font-size:18px;
    cursor:pointer;
    user-select:none;
    z-index:8200;
    color: #fff;
  }
  .icon img { width:60px; filter: drop-shadow(0 6px 12px rgba(0,0,0,0.6)); }

  /* DOCK Mac OS */
  .dock {
    position:fixed;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    background: rgba(255,255,255,0.06);
    padding:10px 20px;
    border-radius:20px;
    display:flex;
    align-items:center;
    gap:15px;
    backdrop-filter: blur(10px);
    z-index:8300;
    box-shadow: 0px 6px 20px rgba(0,0,0,0.5);
  }

  #start-button {
    width:50px; height:50px;
    background: rgba(30,144,255,0.95);
    border-radius:12px; display:flex; align-items:center; justify-content:center; cursor:pointer; flex-shrink:0;
  }
  #start-button::before { content:""; width:22px; height:22px; background: url('https://upload.wikimedia.org/wikipedia/commons/5/5f/Windows_logo_-_2012.svg') no-repeat center/contain; display:block; }

  .dock img { width:60px; height:60px; cursor:pointer; transition: transform 0.2s; }
  .dock img:hover { transform: scale(1.5); }

  @keyframes bounce { 0%{transform:translateY(0) scale(1);} 30%{transform:translateY(-12px) scale(1.05);} 60%{transform:translateY(5px) scale(0.95);} 100%{transform:translateY(0) scale(1);} }
  .bounce { animation: bounce 0.4s ease; }

  /* Start Menu */
  #start-menu {
    position:fixed; top:50%; left:50%; transform:translate(-50%,-50%) scale(0.7);
    width:600px; height:400px; background: rgba(255,255,255,0.95); color:black; border-radius:15px; box-shadow:0 15px 40px rgba(0,0,0,0.4);
    display:none; flex-direction:column; padding:20px; z-index:8400; overflow:hidden; opacity:0;
  }
  #start-menu.show { display:flex; animation: startMenuShow 0.3s ease forwards; }
  @keyframes startMenuShow { 0%{transform:translate(-50%,-50%) scale(0.7); opacity:0;} 80%{transform:translate(-50%,-50%) scale(1.05); opacity:1;} 100%{transform:translate(-50%,-50%) scale(1); opacity:1;} }

  .tiles { display:flex; flex-wrap:wrap; gap:15px; }
  .tile { width:100px; height:100px; background:#0078ff; color:white; display:flex; align-items:center; justify-content:center; border-radius:10px; cursor:pointer; text-align:center; font-weight:bold; font-size:14px; transition: transform 0.2s, background 0.2s; }
  .tile:hover { transform:scale(1.1); background:#005bb5; }

  /* Window */
  .window {
    width:350px; height:250px; background:white; position:absolute; top:120px; left:120px; border-radius:8px; box-shadow:0px 0px 12px rgba(0,0,0,0.6);
    display:none; flex-direction:column; z-index:8500; user-select:none;
  }
  .window-header { background:#0078ff; color:white; padding:8px 12px; cursor:move; user-select:none; }
  .window-body { flex:1; padding:10px; color:black; }
  .close-btn { float:right; cursor:pointer; }

  /* responsive small */
  @media (max-width:480px){
    #start-menu { width:92vw; height:72vh; }
  }
</style>

<!-- Desktop markup -->
<div id="desktop" aria-hidden="true">
  <video id="video-background" autoplay muted loop playsinline>
    <source src="https://www.w3schools.com/howto/rain.mp4" type="video/mp4" />
    Your browser does not support the video tag.
  </video>

  <!-- Desktop Icon -->
  <div class="icon" onclick="openWindow()">
    <img src="https://cdn-icons-png.flaticon.com/512/716/716784.png" alt="File Icon" />
    <div>File</div>
  </div>

  <!-- Window -->
  <div class="window" id="appWindow" role="dialog" aria-label="File Explorer">
    <div class="window-header" id="dragZone">
      File Explorer
      <span class="close-btn" onclick="closeWindow()">âœ–</span>
    </div>
    <div class="window-body">
      <p>Halo! Ini jendela File Explorer.</p>
    </div>
  </div>

  <!-- Dock + Start Button -->
  <div class="dock" role="toolbar" aria-label="Dock">
    <div id="start-button" title="Start" aria-haspopup="true" aria-controls="start-menu" tabindex="0"></div>
    <img src="https://cdn-icons-png.flaticon.com/512/888/888879.png" onclick="bounceIcon(this); openWindow()" alt="App1" />
    <img src="https://cdn-icons-png.flaticon.com/512/732/732245.png" onclick="bounceIcon(this)" alt="App2" />
    <img src="https://cdn-icons-png.flaticon.com/512/732/732223.png" onclick="bounceIcon(this)" alt="App3" />
  </div>

  <!-- Start Menu -->
  <div id="start-menu" aria-hidden="true">
    <h3>Start Menu</h3>
    <div class="tiles" role="grid">
      <div class="tile" onclick="alert('File Explorer clicked')">Explorer</div>
      <div class="tile" onclick="alert('Settings clicked')">Settings</div>
      <div class="tile" onclick="alert('Browser clicked')">Browser</div>
      <div class="tile" onclick="alert('Mail clicked')">Mail</div>
      <div class="tile" onclick="alert('Music clicked')">Music</div>
      <div class="tile" onclick="alert('Photos clicked')">Photos</div>
      <div class="tile" onclick="alert('Games clicked')">Games</div>
      <div class="tile" onclick="alert('Store clicked')">Store</div>
    </div>
  </div>
</div>

<script>
  /* ---------- Desktop interaction scripts ---------- */

  // Bounce effect dock
  function bounceIcon(icon) {
    icon.classList.add("bounce");
    setTimeout(() => icon.classList.remove("bounce"), 400);
  }

  // Open/Close window
  function openWindow() {
    document.getElementById("appWindow").style.display = "flex";
  }
  function closeWindow() {
    document.getElementById("appWindow").style.display = "none";
  }

  // Drag window
  (function attachDrag(){
    const win = document.getElementById("appWindow");
    const dragZone = document.getElementById("dragZone");
    if(!win || !dragZone) return;

    let offsetX = 0, offsetY = 0, isDragging = false;

    dragZone.addEventListener('mousedown', (e) => {
      isDragging = true;
      offsetX = e.clientX - win.offsetLeft;
      offsetY = e.clientY - win.offsetTop;
      win.style.transition = 'none';
    });

    document.addEventListener('mousemove', (e) => {
      if (isDragging) {
        win.style.left = (e.clientX - offsetX) + "px";
        win.style.top = (e.clientY - offsetY) + "px";
      }
    });

    document.addEventListener('mouseup', () => {
      if(isDragging){
        isDragging = false;
        win.style.transition = '';
      }
    });

    // touch support
    let touchStart = null;
    dragZone.addEventListener('touchstart', (e) => {
      const t = e.touches[0];
      touchStart = {x: t.clientX - win.offsetLeft, y: t.clientY - win.offsetTop};
    }, {passive:true});
    dragZone.addEventListener('touchmove', (e) => {
      if(!touchStart) return;
      const t = e.touches[0];
      win.style.left = (t.clientX - touchStart.x) + "px";
      win.style.top = (t.clientY - touchStart.y) + "px";
    }, {passive:true});
    dragZone.addEventListener('touchend', () => touchStart = null);
  })();

  // Start menu toggle with animation
  (function startMenuLogic(){
    const startButton = document.getElementById('start-button');
    const startMenu = document.getElementById('start-menu');

    startButton.addEventListener('click', (e) => {
      e.stopPropagation();
      if (startMenu.classList.contains('show')) {
        startMenu.classList.remove('show');
        setTimeout(() => startMenu.style.display = 'none', 300);
      } else {
        startMenu.style.display = 'flex';
        requestAnimationFrame(() => {
          startMenu.classList.add('show');
        });
      }
    });

    // Allow keyboard open (Enter/Space)
    startButton.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' '){
        e.preventDefault();
        startButton.click();
      }
    });

    // close start menu if click outside
    document.addEventListener('click', (e) => {
      if (!startMenu.contains(e.target) && e.target !== startButton) {
        if (startMenu.classList.contains('show')) {
          startMenu.classList.remove('show');
          setTimeout(() => startMenu.style.display = 'none', 300);
        }
      }
    });
  })();

  // prevent overlay unlock re-trigger (overlay is removed on unlock)
  // nothing more needed here
</script>

</body>
</html>
